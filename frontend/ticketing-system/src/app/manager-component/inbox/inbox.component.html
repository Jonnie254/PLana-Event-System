<div class="flex h-screen bg-gray-100 mt-2">
    <!-- Sidebar -->
    <aside class="w-1/4 bg-gray-200 border-r border-gray-300">
        <!-- Chat Rooms List -->
        <div class="p-4">
            <h2 class="text-xl font-semibold mb-4">Event Chat Room</h2>
            <div *ngIf="chatRooms.length === 0" class="text-gray-600 italic">
                {{ noRoomsMessage }}
            </div>
            <ul *ngIf="chatRooms.length > 0" class="space-y-2">
                <li *ngFor="let chatRoom of chatRooms">
                    <a (click)="selectChatRoom(chatRoom)" [class.bg-gray-300]="selectedChatRoom?.id === chatRoom.id"
                        class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-300 cursor-pointer">
                        <div class="h-10 w-10 bg-gray-400 rounded-full">
                            <img [src]="chatRoom.event.image" alt="" class="h-10 w-10 rounded-full object-cover">
                        </div>
                        <div>
                            <div class="font-semibold">{{ chatRoom.event.name }}</div>
                            <div class="text-sm text-gray-600">
                                {{ chatRoom.latestMessage?.message || 'No messages' }}
                            </div>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
    </aside>
    <!-- Main Content: Chat Window and Input -->
    <main class="flex-1 flex flex-col">
        <!-- Chat Header -->
        <header class="p-4 bg-white border-b border-gray-300">
            <div *ngIf="selectedChatRoom; else noRoomSelected" class="flex items-center space-x-2">
                <div class="h-10 w-10 bg-gray-400 rounded-full">
                    <img [src]="selectedChatRoom.event.image" alt="" class="rounded-full h-10 w-10 object-cover">
                </div>
                <div>
                    <div class="font-semibold">{{ selectedChatRoom.event.name }}</div>
                    <div class="text-sm text-gray-600">Online</div>
                </div>
            </div>
            <ng-template #noRoomSelected>
                <div class="text-gray-600 italic">Select a chat room to start messaging</div>
            </ng-template>
        </header>

        <!-- Chat Messages -->
        <div class="flex-1 p-4 overflow-y-auto bg-gradient-to-b from-gray-50 to-white" #messagesContainer>
            <div *ngIf="!selectedChatRoom" class="text-center text-gray-600 italic">
                Select a chat room to view messages
            </div>
            <div *ngFor="let message of messages" class="mb-4">
                <!-- Message bubble structure remains the same -->
                <div [ngClass]="{'flex-row-reverse': message.sender?.id === currentUserId, 'flex-row': message.sender?.id !== currentUserId}"
                    class="flex items-end">
                    <div class="h-8 w-8 rounded-full overflow-hidden flex-shrink-0">
                        <img [src]="message.sender?.profileImage || 'profilepic.svg'" alt=""
                            class="h-full w-full object-cover">
                    </div>
                    <div class="flex flex-col max-w-[70%] mx-2"
                        [ngClass]="{'items-end': message.sender?.id === currentUserId}">
                        <div class="px-4 py-2 rounded-2xl relative shadow-sm" [ngClass]="{
                                        'bg-blue-500 text-white': message.sender?.id === currentUserId,
                                        'bg-gray-400 text-white': message.sender?.id !== currentUserId
                                    }">
                            <p class="text-sm">{{ message.message || 'No message' }}</p>
                            <div class="absolute bottom-0 w-3 h-3 overflow-hidden" [ngClass]="{
                                            'right-[-6px]': message.sender?.id === currentUserId,
                                            'left-[-6px]': message.sender?.id !== currentUserId
                                        }">
                                <div class="w-4 gap-2 h-4 transform rotate-45 origin-bottom-left" [ngClass]="{
                                                'bg-blue-500': message.sender?.id === currentUserId,
                                                'bg-blue-400': message.sender?.id !== currentUserId
                                            }">
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center mt-1 text-xs text-gray-500"
                            [ngClass]="{'flex-row-reverse': message.sender?.id === currentUserId}">
                            <span>{{ message.sender?.email || 'Unknown' }}</span>
                            <span class="mx-1">â€¢</span>
                            <span>{{ message.createdAt | date: 'shortTime' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Message Input -->
        <div class="border-t flex items-center p-4 bg-gray-50">
            <div class="flex-1 relative">
                <input type="text" [(ngModel)]="newMessage" (keyup.enter)="sendMessage()"
                    placeholder="Type a message..."
                    class="w-full p-3 pr-24 rounded-full border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 transition duration-150 ease-in-out"
                    [disabled]="!selectedChatRoom">
                <button (click)="sendMessage()"
                    class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-full transition duration-150 ease-in-out flex items-center space-x-2"
                    [disabled]="!selectedChatRoom">
                    <span>Send</span>
                    <i class="pi pi-send"></i>
                </button>
            </div>
        </div>
    </main>
</div>